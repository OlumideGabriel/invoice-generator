<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Invoice {{ invoice_number }}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Helvetica, Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
      color: #121722;
      line-height: 1.5;
    }

    .invoice-container {
      width: 210mm;
      min-height: 297mm;
      margin: 0 auto;
      background: white;
      padding: 30px 40px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      position: relative;
    }

    /* Header Section */
    .header-section {
      padding: 20px;
      background: #F2F5F9;
      border-radius: 8px;
      margin-bottom: 30px;
    }

    .invoice-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .invoice-title {
      font-size: 40px;
      font-weight: 500;
      color: #2D3748;
    }

    .invoice-number {
      font-size: 20px;
      font-weight: 400;
      color: #718096;
      margin-top: -10px;

    }

    .invoice-meta-label {
      color: #718096;
      font-size: 13px;
      text-align: right;
    }

    .date-value {
      color: #2D3748;
      font-weight: 500;
    }

    .top-section {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    /* Billing Section */
    .billing-section {
      width: 45%;
    }

    .billing-label {
      color: #718096;
      font-size: 12px;
    }

    .client-name {
      font-size: 18px;
      font-weight: 600;
      color: #2D3748;
    }

    .client-address {
      color: #4A5568;
      font-size: 14px;
      line-height: 1.4;
    }

    /* Company Logo */
    .company-logo {
      text-align: right;

    }

    .company-logo img {
      max-height: 75px;
      width: auto;
      border-radius: 3px;
    }

    /* Services Section */
    .services-section {
      margin: 30px 0;
    }

    .services-title {
      font-size: 20px;
      font-weight: 600;
      color: black;
      margin-bottom: 15px;
      padding-bottom: 7px;
    }

    .services-table {
      width: 100%;
      border-collapse: collapse;
    }


    .services-table thead th {
      border: none;
      padding-right: 20px;
      padding-left: 20px;
      padding-bottom: 20px;
      padding-top: 5px;
      text-align: left;
      font-weight: 500;
      font-size: 14px;

    }
    .services-table thead th:nth-child(1) {
        border-radius: 4px 0 0 4px;
        font-weight: 700;
        color: #121722;
        font-size: 15px;

        }

    .services-table thead th:nth-child(4) {
        border-radius: 0 4px 4px 0;

        }

    .services-title {
        border-radius: 6px;
        }

    .services-table thead th:nth-child(2),
    .services-table thead th:nth-child(3),
    .services-table thead th:nth-child(4) {
      text-align: right;
      color: #60737D;
    }

    .services-table tbody td {
      border: none;
      padding: 2px 20px; /* Increased padding for item list */
      vertical-align: top;
    }


    .services-table tbody td:nth-child(2),
    .services-table tbody td:nth-child(3),
    .services-table tbody td:nth-child(4) {
      text-align: right;
    }

    .item-name {
      font-weight: 500;
      color: #2D3748;
      font-size: 15px;
    }

    .item-description {
        color: #121722;
      font-size: 13px;
      margin-top: 2px;
    }

    .item-total {
      font-size: 15px;
      font-weight: 500;
    }
    .item-qty, .item-price {
      color: #60737D;
      font-size: 15px;
      font-weight: 500;
    }

    /* Totals Section */
    .totals-section {
      display: flex;
      justify-content: flex-end;
      margin-top: 50px;

    }

    .totals-container {
      width: 300px;

    }

    .subtotal-row {
        display: flex;
        justify-content: right;
        gap: 40px;
        align-items: center;
        padding-right: 20px;
        font-size: 14px;
        }

    .total-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
    }

    .total-label {
      color: #4A5568;

    }

    .total-amount {
      color: #2D3748;
      font-weight: 500;
    }
      .subtotal-amount {
      color: #2D3748;
      font-weight: 500;
      min-width: 80px;
      max-width: 100px;
        text-align: right;
    }

    .grand-total {
      margin-top: 10px;
      padding-top: 10px;
      padding-bottom: 10px;
      padding-left: 50px;
      padding-right: 20px;
      font-weight: 500;
      font-size: 15px;
      background: #F2F5F9;
      border-radius: 10px;
    }

    .grand-total .total-amount {
      font-weight: 600;
      color: #121722;
      font-size: 20px;

    }

    /* Footer Section */
    .footer-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      padding-top: 30px;
    }

    .footer-column h3 {
      font-size: 16px;
      font-weight: 600;
      color: #2D3748;
      margin-bottom: 5px;
    }

    .footer-column p {
      font-size: 14px;
      color: #4A5568;
      line-height: 1.5;
      margin-bottom: 8px;
    }

    .footer-column a {
      color: #4299E1;
      text-decoration: none;
    }

    .payment-info {
      background: #F2F5F9;
      padding: 15px;
      border-radius: 6px;
      line-height: 1.1;
    }

    /* Print Styles */
    @media print {
      body {
        background: white;
        padding: 0;
      }

      .invoice-container {
        box-shadow: none;
        margin: 0;
        width: 100%;
        min-height: auto;
        padding: 10mm;
      }


    }

    @page {
      size: letter;
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="invoice-container">
    <!-- Company Logo -->


    <div class="company-logo invoice-header">
      {% if logo_url %}
        <img src="{{ logo_url }}" alt="Company Logo">
      {% elif company_logo %}
        <img src="{{ company_logo }}" alt="Company Logo">
        {% else %}
        <div style="font-size: 30px; color: #718096; font-weight: 800; margin-left: 10px;
         align-items: center; display: flex; height: 75px; justify-content: center;">
            {{ from }}
        </div>
      {% endif %}

      <div>
          <h1 class="invoice-title">Invoice</h1>
          <div class="invoice-number">#{{ invoice_number }}</div>
        </div>
    </div>

    <!-- Header Section -->
    <div class="header-section">


      <div class="top-section">
        <!-- Billing Information -->
        <div class="billing-section">
          <div class="billing-label" >From:</div>
          <div class="client-name" style="margin-bottom: 10px;">
            {% if from %}
              {{ from.split('\n')[0] if '\n' in from else from }}
            {% else %}
              Client Name
            {% endif %}
          </div>
          <div class="client-address">
            {% if from and '\n' in from %}
              {{ from.split('\n')[1:] | join('<br>') | safe }}
            {% endif %}
          </div>
          <!-- From Information -->
        {% if to %}
        <div>
          <div class="billing-label">Bill To:</div>
          <div class="client-name">
            {{ to.split('\n')[0] if '\n' in to else to }}
          </div>
          <div class="client-address">
            {% if '\n' in to %}
              {{ to.split('\n')[1:] | join('<br>') | safe }}
            {% endif %}
          </div>
        </div>
        {% endif %}
        </div>

        <!-- Dates -->
        <div>
          <div class="invoice-meta-label">Issue Date</div>
          <div class="date-value">
            {% if issued_date %}
              {{ issued_date }}
            {% else %}
              {{ date }}
            {% endif %}
          </div>

          {% if due_date %}
          <div class="invoice-meta-label" style="margin-top: 15px;">Due Date</div>
          <div class="date-value">{{ due_date }}</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Items Table -->
    <div class="services-section">

      <table class="services-table">
        <thead class="services-title">
          <tr>
            <th style="width: 50%">Items & Description</th>
            <th style="width: 15%; text-align: right">Quantity</th>
            <th style="width: 20%; text-align: right">Unit Price</th>
            <th style="width: 15%; text-align: right">Amount</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>
              <div class="item-name">{{ item.name }}</div>
              {% if item.description %}
              <div class="item-description">{{ item.description | replace('\n', '<br>') | safe }}</div>
              {% endif %}
            </td>
            <td class="item-qty">{{ item.quantity }}</td>
            <td class="item-price">${{ "%.2f"|format(item.unit_cost) }}</td>
            <td class="item-total">${{ "%.2f"|format(item.quantity * item.unit_cost) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Totals Section -->
    <div class="totals-section">
      <div class="totals-container">
        <div class="subtotal-row">
          <div class="total-label">Subtotal:</div>
          <div class="subtotal-amount">${{ "%.2f"|format(subtotal) }}</div>
        </div>

        {% if tax_amount > 0 %}
        <div class="subtotal-row">
          <div class="total-label">Tax ({{ tax_percent }}%):</div>
          <div class="subtotal-amount">${{ "%.2f"|format(tax_amount) }}</div>
        </div>
        {% endif %}

        {% if discount_amount > 0 %}
        <div class="subtotal-row">
          <div class="total-label">Discount ({{ discount_percent }}%):</div>
          <div class="subtotal-amount">-${{ "%.2f"|format(discount_amount) }}</div>
        </div>
        {% endif %}

        <div class="total-row grand-total">
          <div class="total-label">Total ({{ currency }}):</div>
          <div class="total-amount">${{ "%.2f"|format(total) }}</div>
        </div>
      </div>
    </div>

    <!-- Footer Section -->
    <div class="footer-section">
      {% if payment_details or payment_instructions %}
      <div class="footer-column">
        <h3>Payment Information</h3>
        <div class="payment-info">
          {% if payment_details %}
            {{ payment_details | replace('\n', '<br>') | safe }}
          {% endif %}
          {% if payment_instructions %}
            {{ payment_instructions | replace('\n', '<br>') | safe }}
          {% endif %}
        </div>
      </div>
      {% endif %}

    </div>
    <div class="footer-section">
     {% if terms %}
      <div class="footer-column">
        <h3>Terms & Conditions</h3>
        <p>{{ terms | replace('\n', '<br>') | safe }}</p>
      </div>
      {% endif %}
      </div>
  </div>
</body>
</html>